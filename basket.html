<!DOCTYPE html>

<html lang="en">
  <head>
%include _head.html
    <title>Movie Rentals</title>
  </head>

  <body>

    <header>
%include _head.html

    </header>

%include _navbar.html

    <div class="container-fluid">
      <div class="row">
        <div class="col-8">
            <h1 style="text-align: center">Basket</h1>

            <div>
            <table style="width: 100%">
                <tr>
                    <th> Details </th>
                    <th> Quantity </th>
                    <th> Price </th>
                </tr>
                <tbody id="basket"></tbody>

              </table>

              <hr />

              <a class="btn btn-secondary" href="/shop.html">Continue Shopping</a>

              <button class="btn btn-danger" onclick="localStorage.setItem('basket', '[]');location.reload()">Clear Basket</button>
            </div>
        </div>

        <div id="basket-sidebar" class="col-4">
            <h2>Order Summary</h2>
            <table style="width: 100%">

            <tbody id="total"></tbody>

          </table>
          <div>
              <div style="text-align: right"><strong>Total Price:</strong> £<span id="total-price"></span></div>
              <a class="btn btn-primary" style="width: 100%" href="/order.html">Pay</a>
          </div>
        </div>

      </div>

    </div>

  </body>



  <script src="./js/movies.js"></script>

  <script>

    const basketContainer = document.getElementById("basket");
    const totalContainer = document.getElementById("total");



    const basket = JSON.parse(localStorage.getItem("basket") ?? "[]");



    let totalPrice = 0.0;



    basket.forEach((basketItem) => {
      var cost = basketItem.price * basketItem.rentDays;

      totalContainer.insertAdjacentHTML(
        "beforeend",
        `
            <tr>

                <td>${basketItem.name}</td>

                <td>£${Math.round(cost*100) / 100}</td>

            </tr>
        `
      );
      basketContainer.insertAdjacentHTML(
        "beforeend",
        `
            <tr>

                <td>
                    <img style="display: inline" width="10%" src="${basketItem.image}"></img>
                    <p style="display: inline">${basketItem.name}</p>
                <td>
                <td>${basketItem.rentDays}</td>

                <td>£${Math.round(cost*100) / 100}</td>

            </tr>
        `
      );
      totalPrice += basketItem.price * basketItem.rentDays;

    });



    document.getElementById("total-price").textContent = Math.round((totalPrice * 1.2)*100)/100;

  </script>

</html>

