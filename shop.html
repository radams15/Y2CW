<html lang="en">
  <head>
%include _head.html
    <title>Movie Rentals</title>
  </head>
  <body>
    <div class="container-fluid" id="main">

%include _navbar.html

      <div class="row">
        <div id="sidebar" class="col-mg-2 col-sm-2">
            <ul class="">
              <li><button type="button" class="btn btn-secondary" onclick="layout()">All</button></li>
              <li><button type="button" class="btn btn-secondary" onclick="layout('Adventure')">Adventure</button></li>
              <li><button type="button" class="btn btn-secondary" onclick="layout('Animation')">Animation</button></li>
              <li><button type="button" class="btn btn-secondary" onclick="layout('Science fiction')">Science fiction</button></li>
              <li><button type="button" class="btn btn-secondary" onclick="layout('Comedy')">Comedy</button></li>
              <li><button type="button" class="btn btn-secondary" onclick="layout('Drama')">Drama</button></li>
              <li><button type="button" class="btn btn-secondary" onclick="layout('Horror')">Horror</button></li>
              <li><button type="button" class="btn btn-secondary" onclick="layout('Action')">Action</button></li>
            </ul>
        </div>
          
        <div class="col-mg col-sm">
            <article id="movie_list">
              
            </article>
        </div>
      </div>
    </div>

    <script src="./js/movies.js"></script>
    <script>
        function layout(genre=null) {
            var movieList = document.getElementById('movie_list');
            
            movieList.innerHTML = '';
            
            for(var movie of movies) {
                if(!genre || movie.genre.split(', ').includes(genre)) {                
                    // This is the wrong way to do this as it has a large risk of including arbitrary HTML tags, but security doesn't matter.
                    movieList.innerHTML += `
                        <div class="container movie-row">
                          <div class="row">
                              <div class="col">
                                  <div>
                                    <img class ="image" src="${movie.image}" />
                                  </div>
                              </div>

                              <div class="col">
                                  <div>
                                    <h4>${movie.name}</h4>
                                    <p>
                                      ${movie.description}
                                    </p>
                                  </div>
                                  <div>
                                    <a class="btn btn-primary" href="/movie.html?id=${movie.id}">More Info</a><br />
                                    <br>
                                    <label>Days to rent:</label>
                                    <input id="days-to-rent-${movie.id}" value="3" /><br><br>
                                    <button class="btn btn-danger" onclick="addToBasket(${movie.id})">Add to Basket</button>
                                  </div>
                              </div>
                          </div>
                        </div>
                    `;
                }
            }
        }
        
        function addToBasket(movieId) {
            // Get the movie from data and add to the basket
            const movie = movies.find((movie) => movie.id === movieId);
            if (!movie) return;

            // Get the basket from local storage, or just an empty array if it doesn't exist
            const basket = JSON.parse(localStorage.getItem("basket") ?? "[]");

            // Add the amount of days they want to rent
            movie.rentDays = parseInt(document.getElementById("days-to-rent-" + movieId).value);
            basket.push(movie);
            localStorage.setItem("basket", JSON.stringify(basket));
        }
        
        layout();
    </script>
  </body>
</html>
