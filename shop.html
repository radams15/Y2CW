<html lang="en">
  <head>
%include _head.html
    <title>Movie Rentals</title>
  </head>
  <body>
    <div class="container-fluid" id="main">

%include _navbar.html

      <div class="row">
        <div id="sidebar" class="col-mg-2 col-sm-2">
            <ul class="">
              <li><button onclick="layout()">All</button></li>
              <li><button onclick="layout('Adventure')">Adventure</button></li>
              <li><button onclick="layout('Animation')">Animation</button></li>
              <li><button onclick="layout('Science fiction')">Science fiction</button></li>
              <li><button onclick="layout('Comedy')">Comedy</button></li>
              <li><button onclick="layout('Drama')">Drama</button></li>
              <li><button onclick="layout('Horror')">Horror</button></li>
              <li><button onclick="layout('Action')">Action</button></li>
            </ul>
        </div>
          
        <div class="col-mg-2 col-sm-2">
            <article id="movie_list">
              
            </article>
        </div>
      </div>
    </div>

    <script src="./js/movies.js"></script>
    <script>
        function layout(genre=null) {
            var movieList = document.getElementById('movie_list');
            
            movieList.innerHTML = '';
            
            for(var movie of movies) {
                if(!genre || movie.genre.split(', ').includes(genre)) {                
                    // This is the wrong way to do this as it has a large risk of including arbitrary HTML tags, but security doesn't matter.
                    movieList.innerHTML += `
                        <div class="movie">
                          <div>
                            <img class ="image" src="${movie.image}" />
                          </div>
                          <div style="margin: 0 0.75em; width:60%;">
                            <h4 style="margin: 0">${movie.name}</h4>
                            <p>
                              ${movie.description}
                            </p>
                          </div>
                          <div style="float: right;">
                            <a href="/movie.html?id=${movie.id}">View Movie</a><br />
                            <label>Days to rent:</label><br />
                            <input id="days-to-rent-${movie.name}" value="3" /><br />
                            <button style="width: 100px; height: 50px" onclick="addToBasket(${movie.id})">Add to Basket</button>
                          </div>
                        </div>
                    `;
                }
            }
        }
        
        function addToBasket(movieId) {
            // Get the movie from data and add to the basket
            const movie = movies.find((movie) => movie.id === movieId);
            if (!movie) return;

            // Get the basket from local storage, or just an empty array if it doesn't exist
            const basket = JSON.parse(localStorage.getItem("basket") ?? "[]");

            // Add the amount of days they want to rent
            movie.rentDays = parseInt(document.getElementById("days-to-rent-" + movieId).value);
            basket.push(movie);
            localStorage.setItem("basket", JSON.stringify(basket));
        }
        
        layout();
    </script>
  </body>
</html>
